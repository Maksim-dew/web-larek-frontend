# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/types/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

### Данные и типы данных, используемые в приложении

Cписок карточек
```
export interface IlistCard {
  total: number; //кол-во карточек
  items: ICard[]; //элементы карточек
}
```

Типы категорий карточек
```
export type category = 'другое' | 'софт-скил' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Карточка
```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Карточка в списке на главной
```
export type ICardList = Pick<ICard, 'title' | 'image' | 'category' | 'price'>;
```

Карточка в списке корзины
```
export type ICardBascket = Pick<ICard, 'id' | 'title' | 'price'>;
```

Типы оплаты
```
export type payment = 'online' | 'offline';
```

Запрос на заказ
```
export interface IOrderRequest {
  payment: payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Ошибка
```
export interface IErrorResponse {
  error: string;
}
```

Успешный ответ от API
```
export interface ISuccessResponse {
  id: string;
  total: number;
}
```


### Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- Model - слой данных, отвечает за хранение и изменение данных,
- View - слой представления, отвечает за отображение данных на странице,
- Presenter - отвечает за связь представления и данных.

### Базовый код 

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `responseProcessError` - обрабатывает  ошибку, полученную от сервера и возвращает объект с ошибкой.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Методы:

  - `on` - подписка на событие
  - `emit` - инициализация события
  - `trigger`  - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс IProduct
Отвечает за хранение в себе данных о конкретной карточке. 
  - `_id: string;` -  уникальный идентификатор карточки.
  - `_description: string;` -  описание карточки.
  - `_image: string;` -   ссылка на изображение карточки.
  - `_title: string;` -    название карточки. 
  - `_category: string;` - категория карточки.
  - `_price: number | null;` - цена товара.
  
#### Класс IProductBascket
  Отвечаетза  хранение данных о корзине. 
  `Pick<IProduct, 'id' | 'title' | 'price'>` - берет поля `'id' | 'title' | 'price'` из класса IProduct.

#### Класс IProductList
  Отвечает за даные на главной странице. 
  `Pick<IProduct, 'title' | 'image' | 'category' | 'price'>` - берет поля `'title' | 'image' | 'category' | 'price'` из класса IProduct.

#### Класс IContactsForm
Хранит введеные  данные формы контактов.
  - `_email: string` -  почта.
  - `_phone: string` -  номер телефона.

#### Класс IOrderForm
Хранит введеные  данные формы адреса.
  - `_payment: string` -  тип оплаты.
  - `_address: string` -  адресс.

#### Класс IOrderSuccess
Хранит  данные о заказе.
  - `_id: string` -  номер заказа.
  - `_total: number` -  сумма заказа.

#### Класс IAppState
Класс отвечает за управление состоянием приложения, включая каталог продуктов, корзину, текущий заказ и ошибки формы.\
В полях класса хранятся следующие данные:
- `_catalog: Product[]` - массив объектов товаров
- `_selectedProduct: Product | null` - товар, выбранный для просмотра в модальной окне
- `_order: Order | null` - текущий заказ.
- `_basket: Product[] | null` - корзина с добавленными товарами
- `preview: string | null` - содержит id товара, открытого для  предварительного просмотра
- `formErrors: FormErrors` - содержит ошибки формы.

Так же класс обладает набором методов:
- `selectProduct(item: IProduct): void` - метод, меняющий выбранный товар, в случае открытия его описания
- `addProduct(item: IProduct): void` - отвечает за добавление товара в корзину
- `removeProduct(item: IProduct): void` - отвечает за удаление товара из корзины
- `refreshBasket(): void` - отвечает за обновление корзины и счетчика при добавлении и удалении товаров
- `setOrderField(field: keyof IOrderForm, value: string)` - отвечает за передачу данных из формы заказа
- `setContactField(field: keyof IContactsForm, value: string)` - отвечает за передачу данных из формы контактов
- `clearBasket(): void` - отвечает за очистку корзины
- `clearOrder(): void` - очищает данные заказа;
- `getBasketTotal(): number` - позволяет получить количество товаров в корзине
- `validateContact()` - отвечает за валидацию данных в форме контактов
- `validateOrder()` - отвечает за валидацию данных в заказе
- `setCatalog(): Promise<Product[]>` - устанавливает каталог продуктов


### Классы представления
Все классы представления отвечают  за отображение данных на странице.  В них реализованы методы для отображения данных и обновления данных.

### Класс Page
Отвечает за отображение списка товаров и иконку корзины покупателя со счетчиком товаров.

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, цены, описания. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.
Методы:
-`set id` - присваивает  уникальный идентификатор карточки.
-`set title` - присваивает  название карточки.
-`set image` - присваивает   изображение карточки.
-`set price` - присваивает   цену карточки.
-`set category` - присваивает    категорию карточки.
-`set description` - присваивает    описание карточки.
Аналогично есть метод `get`.

#### Класс Basket
Отвечает за отображение краткой информации о товаре в списке товаров корзины.

- `_list: HTMLElement` - элемент-контейнер списка товаров
- `_price: HTMLElement` - элемент с текстом об общей стоимости товаров в корзине
Методы:
- `set items` - установка счетчика  товаров в корзине.
- `set total` - цена товаров в корзине.

#### Класс OrderForm
Представляет форму заказа с выбором способа оплаты и адреса доставки.
Поля класса:
- `_paymentCardButton` - кнопка для выбора онлайн-оплаты;
- `_paymentCashButton` - кнопка для выбора оплаты при получении;
- `_address` - поле ввода адреса доставки.
Конструктор: Инициализирует форму, добавляет обработчики событий для кнопок выбора способа оплаты.
Методы:
- `set address` - свойство, устанавливает значение адреса доставки;
- `toggleButtons` - переключает активное состояние кнопок выбора способа оплаты;

#### Класс ContactsForm
Расширяет класс Form.Отвечает за отображение второй из двух форм заказа.
Методы:
- `set phone` -  свойство, устанавливает значение номера телефона.
- `set email` -  свойство, устанавливает значение email.

#### Класс Success
Отвечает за отображение блока подтверждения заказа.
Поля:
- `__close: HTMLElement;` -  кнопка закрытия блока подтверждения заказа.
 - `_description: HTMLElement;` - текстовое поле с описанием.
Методы: 
- `set description` -  свойство, устанавливает значение описания.

### Слой коммуникации

#### Класс ActionApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Модели данных событий не генерируют.

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)

- `items:changed` - обновление списка продуктов;
- `card:select` - открытие карточки и блокировка интерфейса;
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `preview:changed` - событие рендеринга предварительного просмотра товара;
- `product:add` - добавление товара в корзину;
- `product:delete` - удаление товара в корзину;
- `basket:open` - открытие корзины;
- `basket:changed` - обновление интерфейса корзины;
- `counter:changed` - обновление значения счетика корзины;
- `order:open` - открытие формы заказа;
- `order:changed` - изменения в заказе;
- `order.address:change` - изменение адреса
- `contacts:change` - изменение контактов
- `formErrors:changed` - ошибки формы
- `order:ready` - событие валидности формы оплаты;
- `contact:ready` - событие валидности формы контактов;
- `order:submit` - подтверджение формы оплаты;
- `contacts:submit` - подтверджение формы контактов;