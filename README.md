# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/types/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

### Данные и типы данных, используемые в приложении

Cписок карточек
```
export interface IlistCard {
  total: number; //кол-во карточек
  items: ICard[]; //элементы карточек
}
```

Типы категорий карточек
```
export type category = 'другое' | 'софт-скил' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Карточка
```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Карточка в списке на главной
```
export type ICardList = Pick<ICard, 'title' | 'image' | 'category' | 'price'>;
```

Карточка в списке корзины
```
export type ICardBascket = Pick<ICard, 'id' | 'title' | 'price'>;
```

Типы оплаты
```
export type payment = 'online' | 'offline';
```

Запрос на заказ
```
export interface IOrderRequest {
  payment: payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Ошибка
```
export interface IErrorResponse {
  error: string;
}
```

Успешный ответ от API
```
export interface ISuccessResponse {
  id: string;
  total: number;
}
```


### Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- Model - слой данных, отвечает за хранение и изменение данных,
- View - слой представления, отвечает за отображение данных на странице,
- Presenter - отвечает за связь представления и данных.

### Базовый код 

### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Методы:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger`  - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс IListData

Отвечает за хранение в себе карточек. В классе реализованы методы для добавления, обновления, удаления и получения карточек. 
  - `_items: ICard[]` - массив с карточками.
  - `getCard(cardId: ICard): void;` - ищет товар по id
  
#### Класс ICard
Отвечает за хранение в себе данных о конкретной карточке. 
  - `_id: string;` -  уникальный идентификатор карточки.
  - `_description: string;` -  описание карточки.
  - `_image: string;` -   ссылка на изображение карточки.
  - `_title: string;` -    название карточки. 
  - `_category: string;` - категория карточки.
  - `_price: number | null;` - цена товара.
#### Класс IOrderBascket
Отвечаетза  хранение в себе данных о корзине. 
  - `_payment: payment;` - содержит в себе информацию об методе оплаты.
  - `_email: string;` -  email пользователя.
  - `_phone: string;` -  телефон пользователя.
  - `_address: string;` -   адрес пользователя. 
  - `_total: number;` -    общая стоимость товаров в корзине.
  - `_items: ICardBascket[];` -  товары в корзине. 
  - `validateEmail(email: string): boolean;` -  метод проверяет email на валидность.
  - `validatePhoneNumber(phone: string): boolean;` -   метод проверяет телефон на валидность.

### Классы представления
Все классы представления отвечают  за отображение данных на странице.  В них реализованы методы для отображения данных и обновления данных.

### Класс Page
Отвечает за отображение списка товаров и иконку корзины покупателя со счетчиком товаров.

Поля класса:

Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `addCard(cardElement: HTMLElement)` для добавления карточек на страницу и сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.
- `basketButton: HTMLElement` - кнопка открытия корзины в модальном окне
- `_basketCounter: HTMLElement` - элемент счетчика товаров в корзине
Конструктор принимает элемент страницы body и экземпляр брокера событий. На кнопку открытия модального окна корзины устанавливается слушатель

#### Класс Modal
Реализует модальное окно. Предназначен для отображения таких компонентов как Card, Basket, Order, Contacts, Success.

Поля класса:
- `_content: HTMLElement` - элемент содежимого модального окна
- `closeButton: HTMLButtonElement` - элемент кнопки закрытия модального окна
- `events: IEvents` - экзепляр брокера событий
Конструктор принимает элемент модального окна и экземпляр класса EventEmitter для возможности инициации событий. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

Методы класса:
- `open()` - открывает модальное окно и запускает событие, блокирующее прокрутку страницы
- `close()` - закрывает модальное окно и запускает событие, разблокирующее прокрутку страницы
- `render(data: TModalContent): HTMLElement` - переписывает метод родительского элемента, добавляя инициацию события открытия модального окна.

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, цены, описания. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- `setData(cardData: ICard, cardId: string): void` - заполняет атрибуты элементов карточки данными.
- `addBasket(): void` - метод добавления карточки в корзину.
- `render(): HTMLElement` - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер `id` возвращает уникальный `id` карточки

#### Класс Card.
Расширяет класс Modal. Реализует отображение модального окна с карточкой товара.
- `_bascketButtton: HTMLButtonElement` - кнопка добавления в корзину.
- `_modalTitle: string` - название карточки.
- `imageElement: HTMLImageElement` - элемент разметки с изображением
- `_modalDescription: string` - описание карточки.
- `_modalPrice: number | null` - цена карточки.
Методы: 
- `addBasket(): void` - метод добавления карточки в корзину.
- `get form: HTMLElement` - геттер для получения элемента формы

#### Класс Form
Расширяет класс Modal. Реализует формы приложения. Устанавливает слушатели на кнопку submit и на инпуты.

Поля класса для хранения и взаимодействия с его данными:
- `_submitButton: HTMLButton` — элемент кнопки подтверждения.
- `_form: HTMLElement` - элемент формы. 
- `_errors: HTMLElement` — элемент ошибки валидации.
- `constructor(protected container: HTMLFormElement, protected events: IEvents)` — принимает контейнер и экзмепляр класса EventEmitter и инициализирует их.
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей формы.

Методы класса для взаимодействия с его данными:
- `setValid(isValid: boolean): void` -  метод для установки валидности формы.
- `getInputValues(): Record<string,  string> | null` - метод возвращает  объект с данными из формы, где ключ - name  поля, а значение - данные введенные пользователем.
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполнения полей формы
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- `get form: HTMLElement` - геттер для получения элемента формы

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Модели данных событий не генерируют.

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)

- `modal:open` - открытие модального окна
- `modal:closed`- закрытие модального окна
- `card:select` - выбор карточки товара для отображения в модальном окне
- `basket:render` - рендер корзины при открытии и ререндер при изменении списка товаров
- `items:change` - изменение списка товаров в корзине (при добавлении и удалении товара)
- `order:start` - начало оформления заказа в корзине
- `order:proceed` - подтверждение заполнения первой формы заказа (способ оплаты и адрес доставки товара)
- `order:place` - подтверждение заполнения второй формы заказа (адрес электронной почты и телефон), отправка данных заказа на сервер
- `order:finished` - закрытие формы подтверждения заказа
